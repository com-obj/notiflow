
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.2">
    
    
      
        <title>Flows - Notiflow</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1118c9be.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ba0d045b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#flows" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Notiflow" class="md-header__button md-logo" aria-label="Notiflow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Notiflow
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Flows
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Notiflow" class="md-nav__button md-logo" aria-label="Notiflow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Notiflow
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Fundamentals
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../features/" class="md-nav__link">
        Features
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Getting started
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Getting started" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        Installation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        Guides
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        Architecture and design
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Architecture and design" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Architecture and design
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Flows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Flows
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#top-level-flows-standard-flow" class="md-nav__link">
    Top-level flows (standard-flow)
  </a>
  
    <nav class="md-nav" aria-label="Top-level flows (standard-flow)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notification-processing-variants" class="md-nav__link">
    Notification processing variants
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-event-routing-flow" class="md-nav__link">
    Input event routing flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-event-extension-converting-flow" class="md-nav__link">
    Input event extension converting flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intent-processing-flow" class="md-nav__link">
    Intent processing flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-processing-flow" class="md-nav__link">
    Message processing flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#email-processing-flow" class="md-nav__link">
    Email processing Flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sms-processing-flow" class="md-nav__link">
    SMS processing Flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mailchimp-processing-flow" class="md-nav__link">
    MailChimp processing Flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-flow" class="md-nav__link">
    Error handling flow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delivery-info-flows" class="md-nav__link">
    Delivery Info flows 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-mode-flow" class="md-nav__link">
    Test mode flow 
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../functions/" class="md-nav__link">
        Functions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../entities/" class="md-nav__link">
        Payloads
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../web-ui/" class="md-nav__link">
        Web UI
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Releases
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Releases" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Releases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#top-level-flows-standard-flow" class="md-nav__link">
    Top-level flows (standard-flow)
  </a>
  
    <nav class="md-nav" aria-label="Top-level flows (standard-flow)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notification-processing-variants" class="md-nav__link">
    Notification processing variants
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-event-routing-flow" class="md-nav__link">
    Input event routing flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-event-extension-converting-flow" class="md-nav__link">
    Input event extension converting flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intent-processing-flow" class="md-nav__link">
    Intent processing flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-processing-flow" class="md-nav__link">
    Message processing flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#email-processing-flow" class="md-nav__link">
    Email processing Flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sms-processing-flow" class="md-nav__link">
    SMS processing Flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mailchimp-processing-flow" class="md-nav__link">
    MailChimp processing Flow 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-flow" class="md-nav__link">
    Error handling flow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delivery-info-flows" class="md-nav__link">
    Delivery Info flows 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-mode-flow" class="md-nav__link">
    Test mode flow 
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="flows">Flows</h1>
<p>Flow is composition of functions (build-in or provided via customisation) that performs some complex logic. Flows can be further composed into final processing flow.</p>
<p>The data between functions in a flow (or between flows) are exchanges via spring integration channels which can me in-memory or configured to some message broker like <a href="https://www.rabbitmq.com/">RabitMQ</a> or <a href="https://kafka.apache.org/">Kafka</a></p>
<h2 id="top-level-flows-standard-flow">Top-level flows (standard-flow)</h2>
<p>The default configuration of notiflow cosists of 4 procesing stages</p>
<ol>
<li><a href="">EventReceiver</a>: Recieve and persist input application <a href="">Event</a></li>
<li><a href="">InputEventExtensionConverting</a>: Event to <a href="">Intent</a>/<a href="">Message</a> conversion</li>
<li><a href="">MessageProcessingFlow</a>: <a href="">Message</a> persistance, formatting, ..</li>
<li><a href="">Sending</a>: Sending different types of messages via dedicated channel</li>
</ol>
<p><img alt="standard-flow" src="/diagrams/png/noti-flow-standard-flow.png" /></p>
<p>This is high level and simplified view on defualt notiflow message processing. Next section describe individual flows in detail</p>
<h3 id="notification-processing-variants">Notification processing variants</h3>
<p>The input to standard-flow (and thus start of input processing) can be done by calling one tree dedicated API enpoints</p>
<ul>
<li><a href="">Input event</a> <ul>
<li>call to <a href="">persistGenericEvent</a> API method</li>
<li>or call REST API <a href="">Post to /events</a> endpoint</li>
</ul>
</li>
<li><a href="">Notification intent</a> <ul>
<li>call <a href="">processIntent</a> API method</li>
</ul>
</li>
<li>Specific <a href="">Message</a> <ul>
<li>call <a href="">processMessage</a> API method</li>
<li>or call REST API <a href="">Post to /messages</a> endpoint</li>
</ul>
</li>
</ul>
<p>Which one of these three types is selected by the client depends on the particular use-case. </p>
<ul>
<li><a href="">Input event</a>: This is used when you want to use notiflow as reciever of any specifi application event your application can produce. This can be events like <ul>
<li>"New order" in web shop</li>
<li>"Low inventory" in wharehouse </li>
<li>User reuquest for 2-factor authentication</li>
<li>... and any other you might need  </li>
</ul>
</li>
</ul>
<p>The intension using this aproach is to ofload as much of the notification processing from the client application as possible. The application focuses on its core business and emits event about what happed. The payload stored in [Input event] can be completely custom and uknown to notiflow</p>
<ul>
<li><a href="">Notification intent</a>: TODO</li>
<li>
<p><a href="">Message</a>: Client application already knows everything about the notification it wants to send, especially </p>
<ul>
<li>who is the recipient</li>
<li>what is the message type (<a href="">Email</a>/<a href="">SMS</a>/<a href="">Push</a>/...)</li>
<li>what is the message content</li>
</ul>
<p>but still wants to use features like <a href="">message delivery guaranties</a>, <a href="">journaling</a>, <a href="">spam preventions</a>, <a href="">statistics</a> and others   </p>
</li>
</ul>
<h2 id="input-event-routing-flow">Input event routing flow <span id="inputEventRoutingFlow"/></h2>
<p><img alt="standard-flow" src="/diagrams/png/input-event-routing.png" /></p>
<p><a href="#inputEventRouting">Input event routing flow</a> is responsible for</p>
<ul>
<li>Recieve an <a href="../entities/#inputEvent">event</a> and retun controll to the caller as soon as possible<ul>
<li>Recieve an <a href="../entities/#inputEvent">event</a></li>
<li>persist the event </li>
<li>return controll to the caller as soon as event persisted in notflow DB</li>
</ul>
</li>
<li><a href="">Poll for events</a> which should start processing and route them based on the notiflow <a href="">configuration</a> for input event routing for further processing</li>
</ul>
<p>This step is only active if client what to use <a href="">event</a> as a starting point for notification processing</p>
<h2 id="input-event-extension-converting-flow">Input event extension converting flow <span id="inputEventExtensionConvertingFlow"/></h2>
<p><img alt="input-event-extension-converting-flow" src="/diagrams/png/input-event-extension-converting.png" /></p>
<p>This <a href="">flow</a> is a place of common customisation. It main purpose is </p>
<ul>
<li>
<p>transleate <a href="">event</a> to either</p>
<ul>
<li><a href="">message</a></li>
</ul>
<p>or</p>
<ul>
<li><a href="">notificationIntent</a></li>
</ul>
</li>
</ul>
<p>Becuase the payload in event is not know to notiflow, client has to provide custom implementation of such conversion. This is done by implementing <a href="">InputEvent2MessageConverterExtension</a> interface. For example</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>        <span class="nd">@Bean</span>
        <span class="kd">public</span> <span class="n">InputEvent2MessageConverterExtension</span> <span class="nf">event2Message</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">InputEvent2MessageConverterExtension</span> <span class="p">()</span> <span class="p">{</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">PayloadValidationException</span><span class="o">&gt;</span> <span class="nf">canHandle</span><span class="p">(</span><span class="n">GenericEvent</span> <span class="n">payload</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="na">getPayloadAsPojo</span><span class="p">()</span> <span class="k">instanceof</span> <span class="n">TestPayload</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
                    <span class="p">}</span>

                    <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span> <span class="n">PayloadValidationException</span><span class="p">(</span><span class="s">&quot;No test payload&quot;</span><span class="p">));</span>                  
                <span class="p">}</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">obj</span><span class="p">.</span><span class="na">nc</span><span class="p">.</span><span class="na">domain</span><span class="p">.</span><span class="na">message</span><span class="p">.</span><span class="na">Message</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">convertEvent</span><span class="p">(</span><span class="n">GenericEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>                    
                    <span class="n">EmailMessage</span> <span class="n">email1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EmailMessage</span><span class="p">();</span>
                    <span class="n">email1</span><span class="p">.</span><span class="na">addRecievingEndpoints</span><span class="p">(</span>
                        <span class="n">EmailEndpoint</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">email</span><span class="p">(</span><span class="s">&quot;test@objectify.sk&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
                    <span class="p">);</span>
                    <span class="n">email1</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">setSubject</span><span class="p">(</span><span class="s">&quot;Subject&quot;</span><span class="p">);</span>
                    <span class="n">email1</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">setText</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">);</span>

                    <span class="n">List</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">obj</span><span class="p">.</span><span class="na">nc</span><span class="p">.</span><span class="na">domain</span><span class="p">.</span><span class="na">message</span><span class="p">.</span><span class="na">Message</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">email1</span><span class="p">);</span>

                    <span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
                <span class="p">}</span>               
            <span class="p">};</span>
        <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p>InputEvent2MessageConverterExtension implementation has to be registered as Spring @Bean</p>
</blockquote>
<h2 id="intent-processing-flow">Intent processing flow <span id="intentProcessingFlow"/></h2>
<p>TODO</p>
<h2 id="message-processing-flow">Message processing flow <span id="messageProcessingFlow"/></h2>
<p><img alt="message-processing-flow" src="/diagrams/png/message-processing-flow.png" />
The responsiblity of this flow is to </p>
<ul>
<li>perform journaling for all <a href="">messages</a> which are about to be send. This includes persistance of <a href="">message</a> and information about <a href="">recipient</a> of the message. </li>
<li>route the <a href="">message</a> to type dependent sender </li>
</ul>
<p>This flow has API that allows to interact with it. Example:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code> <span class="nd">@Autowired</span> <span class="kd">private</span> <span class="n">MessageProcessingFlow</span> <span class="n">msgFlow</span><span class="p">;</span>

 <span class="kt">void</span> <span class="nf">exampleSendMessage</span><span class="p">()</span>  <span class="p">{</span>
        <span class="n">EmailMessage</span> <span class="n">msg</span> <span class="o">=</span> <span class="p">...</span>

        <span class="c1">// when</span>
        <span class="n">msgFlow</span><span class="p">.</span><span class="na">processMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<h2 id="email-processing-flow">Email processing Flow <span id="emailProcessingFlow"/></h2>
<p><img alt="email-processing-flow" src="/diagrams/png/email-processing-flow.png" />
The responsiblity of this flow is to </p>
<ul>
<li>if the <a href="">email is templated</a>, formate it to final <a href="">email message</a></li>
<li>if <a href="">email is localised</a>, send email-per-locale or aggregated into one email</li>
<li>decorated html <a href="">emails</a> to track mail opened by recipient</li>
<li>send <a href="">email</a></li>
</ul>
<p>This flow has API that allows to interact with it. Example:</p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code> <span class="nd">@Autowired</span> <span class="kd">private</span> <span class="n">EmailProcessingFlow</span> <span class="n">emailSendingFlow</span><span class="p">;</span>

 <span class="kt">void</span> <span class="nf">exampleSendFormatedEmail</span><span class="p">()</span>  <span class="p">{</span>
        <span class="n">EmailMessageTemplated</span><span class="o">&lt;?&gt;</span> <span class="n">email</span> <span class="o">=</span> <span class="p">...</span>
        <span class="n">emailSendingFlow</span><span class="p">.</span><span class="na">formatAndSend</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
        <span class="p">...</span>
 <span class="p">}</span>
</code></pre></div>
</td></tr></table>
or 
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@Autowired</span> <span class="kd">private</span> <span class="n">EmailProcessingFlow</span> <span class="n">emailSendingFlow</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">exampleSendEmail</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">EmailMessage</span> <span class="n">email</span> <span class="o">=</span> <span class="p">...</span>

    <span class="n">EmailMessage</span> <span class="n">emailSent</span> <span class="o">=</span> <span class="n">emailSendingFlow</span>
            <span class="p">.</span><span class="na">sendEmail</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
            <span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table></p>
<h2 id="sms-processing-flow">SMS processing Flow <span id="smsProcessingFlow"/></h2>
<p><img alt="sms-processing-flow" src="/diagrams/png/sms-processing-flow.png" />
The responsiblity of this flow is to</p>
<ul>
<li>format <a href="">SMS message</a> content (only templated SMS are supported as of now)</li>
<li>send <a href="">SMS message</a></li>
</ul>
<h2 id="mailchimp-processing-flow">MailChimp processing Flow <span id="mailchimpProcessingFlow"/></h2>
<p><img alt="mailchimp-processing-flow" src="/diagrams/png/mailchimp-processing-flow.png" />
The responsiblity of this flow is to</p>
<ul>
<li>send Email message using <a href="https://mailchimp.com/developer/transactional/">MailChimp transactional API</a>. Formating of the email is in responsibility of MailChimp</li>
</ul>
<h2 id="error-handling-flow">Error handling flow</h2>
<p><img alt="delivery-info-flow" src="/diagrams/png/noti-flow-error-flow.png" /></p>
<p>In the case of exception in any <a href="">function</a> participating in a <a href="">flow</a>, the message that caused the error is recieved by this channel with the information about which step was the last that failed. This flow is reposible for</p>
<ul>
<li>resurection af the failed message and execution of retry </li>
</ul>
<p>For this to work in any situation, <a href="">transaction boundries</a> for steps in flows have to be carefully defined</p>
<h2 id="delivery-info-flows">Delivery Info flows <span id="deliveryInfoFlow"/></h2>
<p><img alt="delivery-info-flow" src="/diagrams/png/delivery-info-flow.png" />
These flows are responsible for persistance of varios journaling information. They listen on predefined topics and document delivery information for given <a href="">event</a>, <a href="">intent</a> and <a href="">message</a></p>
<p>The infomration is later used in <a href="">notiflow UI</a> for cstatistics and analytics</p>
<h2 id="test-mode-flow">Test mode flow <span id="testMode"/></h2>
<p>This is an internal flow which is used in <a href="">test mode</a>. Its responsibility is to </p>
<ul>
<li>Wait for certain time for messages which should have been send if <a href="">test mode</a> was not active</li>
<li>Aggregate them into single digest Email message</li>
<li>Send aggreagted email to predefined recipient</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../examples/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Guides" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Guides
            </div>
          </div>
        </a>
      
      
        
        <a href="../functions/" class="md-footer__link md-footer__link--next" aria-label="Next: Functions" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Functions
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 - 2021 Objectify, s.r.o.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.2b46852b.min.js"></script>
      
    
  </body>
</html>