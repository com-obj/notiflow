
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.5">
    
    
      
        <title>Guides - Notiflow</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a617204b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#examples" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Notiflow" class="md-header__button md-logo" aria-label="Notiflow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Notiflow
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Guides
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Notiflow" class="md-nav__button md-logo" aria-label="Notiflow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Notiflow
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Fundamentals
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../features/" class="md-nav__link">
        Features
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting started" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Guides
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#before-you-begin" class="md-nav__link">
    Before you begin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-simple-email" class="md-nav__link">
    Send simple Email
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-push-notification" class="md-nav__link">
    Send Push notification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-slack-message" class="md-nav__link">
    Send Slack message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-ms-teams-message" class="md-nav__link">
    Send MS Teams message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-sms-message" class="md-nav__link">
    Send SMS message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spam-prevention" class="md-nav__link">
    Spam prevention
  </a>
  
    <nav class="md-nav" aria-label="Spam prevention">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-settings" class="md-nav__link">
    Global settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoint-settings" class="md-nav__link">
    Endpoint settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convert-custom-application-event-to-message" class="md-nav__link">
    Convert custom application event to Message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#templated-email" class="md-nav__link">
    Templated Email
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-test-mode" class="md-nav__link">
    Using Test mode
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgresql-data-source-configuration" class="md-nav__link">
    PostgreSQL data source configuration 
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Architecture and design
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Architecture and design" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Architecture and design
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../flows/" class="md-nav__link">
        Flows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../functions/" class="md-nav__link">
        Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../entities/" class="md-nav__link">
        Payloads
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../web-ui/" class="md-nav__link">
        Web UI
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/event_api/" class="md-nav__link">
        Events
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Releases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Releases" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Releases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#before-you-begin" class="md-nav__link">
    Before you begin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-simple-email" class="md-nav__link">
    Send simple Email
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-push-notification" class="md-nav__link">
    Send Push notification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-slack-message" class="md-nav__link">
    Send Slack message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-ms-teams-message" class="md-nav__link">
    Send MS Teams message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-sms-message" class="md-nav__link">
    Send SMS message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spam-prevention" class="md-nav__link">
    Spam prevention
  </a>
  
    <nav class="md-nav" aria-label="Spam prevention">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-settings" class="md-nav__link">
    Global settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoint-settings" class="md-nav__link">
    Endpoint settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convert-custom-application-event-to-message" class="md-nav__link">
    Convert custom application event to Message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#templated-email" class="md-nav__link">
    Templated Email
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-test-mode" class="md-nav__link">
    Using Test mode
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgresql-data-source-configuration" class="md-nav__link">
    PostgreSQL data source configuration 
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="examples">Examples</h1>
<p>You can find examples on how to use notiflow for specific use-cases. All of these example can be found in the git repository <a href="https://github.com/com-obj/example-flows">here</a>. If you are missing some example, let us know. We will add it in the near future. </p>
<h2 id="before-you-begin">Before you begin</h2>
<ol>
<li>
<p>Check our <a href="https://github.com/com-obj/example-flows/blob/master/build.gradle">gradle dependencies</a> to see external libraries which are used across these examples. </p>
</li>
<li>
<p>Add component scanning to you spring boot application so that the notiflow components are picked up by spring</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="hll"><span class="kn">import</span> <span class="nn">com.obj.nc.Get</span><span class="p">;</span>
</span>
<span class="nd">@SpringBootApplication</span>
<span class="hll"><span class="nd">@ComponentScan</span><span class="p">(</span><span class="n">basePackageClasses</span> <span class="o">=</span> <span class="p">{</span><span class="n">Get</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">SendEmailApplication</span><span class="p">.</span><span class="na">class</span><span class="p">})</span>
</span><span class="hll"><span class="nd">@IntegrationComponentScan</span><span class="p">(</span><span class="n">basePackageClasses</span> <span class="o">=</span> <span class="n">Get</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">YouSpringBootApplication</span> <span class="p">{</span>
</code></pre></div>
</td></tr></table>
</li>
</ol>
<h2 id="send-simple-email">Send simple Email</h2>
<p>This example illustrates the use-case when you simply want to send email with constant body text to single recipient. </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    <span class="nd">@Autowired</span> <span class="kd">private</span> <span class="n">EmailProcessingFlow</span> <span class="n">emailFlow</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>
<p>To start interacting with <a href="../flows/#emailProcessingFlow">email processing flow</a> inject reference to EmailProcessingFlow interface. Then it is straight forward to send an email.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendEmail</span><span class="p">(</span><span class="n">String</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">String</span> <span class="n">subject</span><span class="p">,</span> <span class="n">String</span> <span class="n">msgText</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">EmailContent</span> <span class="n">body</span> <span class="o">=</span> <span class="n">EmailContent</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
                <span class="p">.</span><span class="na">subject</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
                <span class="p">.</span><span class="na">text</span><span class="p">(</span><span class="n">msgText</span><span class="p">)</span>
                <span class="p">.</span><span class="na">build</span><span class="p">();</span>       

        <span class="n">EmailEndpoint</span> <span class="n">emailEndpoint</span> <span class="o">=</span> <span class="n">EmailEndpoint</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">email</span><span class="p">(</span><span class="n">recipient</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>

        <span class="n">EmailMessage</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EmailMessage</span><span class="p">();</span>
        <span class="n">msg</span><span class="p">.</span><span class="na">addReceivingEndpoints</span><span class="p">(</span><span class="n">emailEndpoint</span><span class="p">);</span>
        <span class="n">msg</span><span class="p">.</span><span class="na">setBody</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>

        <span class="n">emailFlow</span><span class="p">.</span><span class="na">sendEmail</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>       
    <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Notiflow is using <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.email">Spring Email Sender</a> for interaction with SMTP server. You need to configure it using you application.properties file</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>spring.mail.host=localhost
spring.mail.port=3025
spring.mail.username=john_doe
spring.mail.password=pwd
</code></pre></div>
</td></tr></table>
<h2 id="send-push-notification">Send Push notification</h2>
<p>This example illustrates how to send push notification to one specific device using <a href="../flows/#pushProcessingFlow">push processing flow</a>. 
Notiflow uses <a href="https://firebase.google.com/docs/cloud-messaging/">Firebase Cloud Messaging</a> for sending 
<a href="https://firebase.google.com/docs/cloud-messaging/android/client">Android</a>, 
<a href="https://firebase.google.com/docs/cloud-messaging/ios/client">iOS</a>, 
<a href="https://firebase.google.com/docs/cloud-messaging/js/client">Web</a> and other push notifications. 
To set up client applications, please refer to included links. 
To be able to communicate with FCM, you need to add path to your Firebase service account file to your <em>application.properties</em> file.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="na">nc.firebase.service-account-file-path</span><span class="o">=</span><span class="s">$HOME/.firebase/service-account-key.json</span>
</code></pre></div>
</td></tr></table>
<p>Inject <em>PushProcessingFlow</em> bean into your sending service.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    <span class="nd">@Service</span>
    <span class="nd">@RequiredArgsConstructor</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SendPushService</span> <span class="p">{</span>

        <span class="c1">// inject push processing flow bean</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">PushProcessingFlow</span> <span class="n">pushProcessingFlow</span><span class="p">;</span>

        <span class="kd">public</span> <span class="n">PushMessage</span> <span class="nf">createMessage</span><span class="p">(</span><span class="n">PushEndpoint</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">String</span> <span class="n">subject</span><span class="p">,</span> <span class="n">String</span> <span class="n">msgText</span><span class="p">)</span> <span class="p">{</span>

            <span class="n">PushMessage</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PushMessage</span><span class="p">();</span>
            <span class="n">message</span><span class="p">.</span><span class="na">setBody</span><span class="p">(</span>
                    <span class="n">PushContent</span>
                            <span class="p">.</span><span class="na">builder</span><span class="p">()</span>
                            <span class="p">.</span><span class="na">subject</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
                            <span class="p">.</span><span class="na">text</span><span class="p">(</span><span class="n">msgText</span><span class="p">)</span>
                            <span class="p">.</span><span class="na">build</span><span class="p">()</span>
            <span class="p">);</span>
            <span class="n">message</span><span class="p">.</span><span class="na">setReceivingEndpoints</span><span class="p">(</span>
                    <span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
            <span class="p">);</span>
            <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send</span><span class="p">(</span><span class="n">PushMessage</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pushProcessingFlow</span><span class="p">.</span><span class="na">sendPushMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Then you can create message and send it to desired endpoint.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendDirectPush</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">PushEndpoint</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="n">PushEndpoint</span><span class="p">.</span><span class="na">ofToken</span><span class="p">(</span><span class="s">&quot;someAndroidDeviceFCMToken&quot;</span><span class="p">);</span>

        <span class="n">PushMessage</span> <span class="n">message</span> <span class="o">=</span> <span class="n">pushService</span>
            <span class="p">.</span><span class="na">createMessage</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="s">&quot;Subject&quot;</span><span class="p">,</span> <span class="s">&quot;Hello World!&quot;</span><span class="p">);</span>

        <span class="n">pushService</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<h2 id="send-slack-message">Send Slack message</h2>
<p>This example illustrates the use-case when you simply want to send slack message with constant body text to single channel.</p>
<p>To start sending messages to public slack channel, first create a bot in slack. For simplicity sake, use example <a href="https://api.slack.com/tutorials/tracks/posting-messages-with-curl">here</a>. Then set application properties as follows:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>nc.slack.apiUrl=https://slack.com/api
nc.slack.botToken=xoxb-2660284751633-2647758251043-lettersAndNumbers
</code></pre></div>
</td></tr></table>
Bot of token always starts with '<em>xoxb-</em>'. Be sure. that your token starts with this prefix.</p>
<p>Next you need channel code. Usually it is part of url (when you are in channel, it is part of url behind last /). 
Replace the <em>public-slack-channel-code</em> in following code sample with your channel code.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">SlackMessageProcessingFlow</span> <span class="n">processingFlow</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">sendSlackMessage</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">SlackMessage</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SlackMessage</span><span class="p">();</span>
        <span class="n">message</span><span class="p">.</span><span class="na">setBody</span><span class="p">(</span><span class="n">SlackMessageContent</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">text</span><span class="p">(</span><span class="s">&quot;Hello World!&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">());</span>
        <span class="n">message</span><span class="p">.</span><span class="na">setReceivingEndpoints</span><span class="p">(</span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">SlackEndpoint</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">channel</span><span class="p">(</span><span class="s">&quot;public-slack-channel-code&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">()));</span>
        <span class="n">processingFlow</span><span class="p">.</span><span class="na">sendMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
</td></tr></table></p>
<h2 id="send-ms-teams-message">Send MS Teams message</h2>
<p>To start sending messages to teams chat, first create an incoming webhook. Follow official <a href="https://docs.microsoft.com/en-us/microsoftteams/platform/webhooks-and-connectors/how-to/add-incoming-webhook">documentation</a>. 
As a result, you have webhook url.</p>
<p>Here is sample how to send message to teams chat:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">TeamsMessageProcessingFlow</span> <span class="n">processingFlow</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">sendShortMessage</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">TeamsMessage</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TeamsMessage</span><span class="p">();</span>

        <span class="kd">final</span> <span class="n">String</span> <span class="n">webhook</span> <span class="o">=</span> <span class="s">&quot;https://webhook.office.com/webhookb2/numbersAndLetters&quot;</span><span class="p">;</span>
        <span class="n">message</span><span class="p">.</span><span class="na">setReceivingEndpoints</span><span class="p">(</span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="k">new</span> <span class="n">TeamsEndpoint</span><span class="p">(</span><span class="n">webhook</span><span class="p">)));</span>
        <span class="n">message</span><span class="p">.</span><span class="na">setBody</span><span class="p">(</span><span class="k">new</span> <span class="n">TeamsMessageContent</span><span class="p">(</span><span class="s">&quot;Hello World!&quot;</span><span class="p">));</span>

        <span class="n">processingFlow</span><span class="p">.</span><span class="na">sendMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
</td></tr></table></p>
<h2 id="send-sms-message">Send SMS message</h2>
<p>Supported way of sending sms is via GatewayApi sms gateway. First create account at https://gatewayapi.com/. Then fill
properties as follows:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>nc.sms.gateway-api.sendSmsUrl=https://gatewayapi.com/rest/mtsms
nc.sms.gateway-api.token=GatewayApiToken
nc.sms.gateway-api.sender=YourCompanyName
</code></pre></div>
</td></tr></table>
Replace <strong>GatewayApiToken</strong> with token from your account and <strong>YourCompanyName</strong> with suitable sender name.</p>
<p>Here is sample how to send sms message:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">SmsProcessingFlow</span> <span class="n">processingFlow</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">sendMessage</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">SmsMessage</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SmsMessage</span><span class="p">();</span>
        <span class="n">message</span><span class="p">.</span><span class="na">setBody</span><span class="p">(</span><span class="n">SimpleTextContent</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">text</span><span class="p">(</span><span class="s">&quot;Hello World!&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">());</span>
        <span class="n">message</span><span class="p">.</span><span class="na">setReceivingEndpoints</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">SmsEndpoint</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">phone</span><span class="p">(</span><span class="s">&quot;+421950123456&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">()));</span>
        <span class="n">processingFlow</span><span class="p">.</span><span class="na">sendMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
</td></tr></table>
Always send sms with correct phone number prefix. In example is +421 used, which is prefix for slovakia. List of prefixes
can be found <a href="https://www.iban.com/dialing-codes">here</a>.</p>
<h2 id="spam-prevention">Spam prevention</h2>
<p>Spam prevention support two ways of configuration: 
- global
- endpoint</p>
<p>When applying spam prevention, the endpoint configuration has priority over global config. Both are not required.</p>
<p>Both configurations share same configuration object with properties:
- maxMessagesUnit (enum) - Allowed values are: <strong>MINUTES</strong>, <strong>HOURS</strong>, <strong>DAYS</strong>.
- maxMessagesTimeFrame (int) - how many units are in time frame
- maxMessages (int) - maximum of sent messages per time frame</p>
<h3 id="global-settings">Global settings</h3>
<p>Actual supported global endpoint configurations are:
- email
- slack
- sms
- teams
- push</p>
<p>Every endpoint has same properties. As example email endpoint configuration is provided.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="na">nc.delivery.spam-prevention.email.maxMessages</span><span class="o">=</span><span class="s">5</span>
<span class="na">nc.delivery.spam-prevention.email.maxMessagesTimeFrame</span><span class="o">=</span><span class="s">1</span>
<span class="na">nc.delivery.spam-prevention.email.maxMessagesUnit</span><span class="o">=</span><span class="s">DAYS</span>
</code></pre></div>
</td></tr></table>
This configuration allows sending of maximum 5 emails per 1 day.</p>
<h3 id="endpoint-settings">Endpoint settings</h3>
<p>One of ways how to implement spam prevention is via implementing SpamPreventionExtension. In the following example
the most important part is method <em>setSpamPreventionSettings</em> when SpamPreventionOption object is created and set to
deliveryOptions.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">class</span> <span class="nc">EmailSpamPreventionExtension</span> <span class="kd">implements</span> <span class="n">SpamPreventionExtension</span> <span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">BasePayload</span><span class="o">&lt;?&gt;</span> <span class="n">apply</span><span class="p">(</span><span class="n">BasePayload</span><span class="o">&lt;?&gt;</span> <span class="n">basePayload</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ReceivingEndpoint</span> <span class="n">endpoint</span> <span class="p">:</span> <span class="n">basePayload</span><span class="p">.</span><span class="na">getReceivingEndpoints</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">endpoint</span> <span class="k">instanceof</span> <span class="n">EmailEndpoint</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">setSpamPreventionSettings</span><span class="p">(</span><span class="n">endpoint</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">basePayload</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">setSpamPreventionSettings</span><span class="p">(</span><span class="n">ReceivingEndpoint</span> <span class="n">receivingEndpoint</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">DeliveryOptions</span> <span class="n">deliveryOptions</span> <span class="o">=</span> <span class="n">receivingEndpoint</span><span class="p">.</span><span class="na">getDeliveryOptions</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">deliveryOptions</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">deliveryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DeliveryOptions</span><span class="p">();</span>
            <span class="n">receivingEndpoint</span><span class="p">.</span><span class="na">setDeliveryOptions</span><span class="p">(</span><span class="n">deliveryOptions</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">deliveryOptions</span><span class="p">.</span><span class="na">setSpamPrevention</span><span class="p">(</span><span class="k">new</span> <span class="n">SpamPreventionOption</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">SpamPreventionOption</span><span class="p">.</span><span class="na">MaxMessageUnit</span><span class="p">.</span><span class="na">DAYS</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table></p>
<h2 id="convert-custom-application-event-to-message">Convert custom application event to Message</h2>
<p>Covering custom event is very common use-case for notiflow. This separation of responsibility ensures that client application does its job and only emits application events if something important happens. The processing of such events, with regards to notification of users or 3rd parties, is in the responsibility of notiflow. </p>
<p>In this example we will send an welcome email to  newly registered customer. Let us first define custom event </p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@JsonTypeInfo</span><span class="p">(</span><span class="n">use</span> <span class="o">=</span> <span class="n">Id</span><span class="p">.</span><span class="na">CLASS</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NewCustomerRegistrationEvent</span> <span class="kd">implements</span> <span class="n">IsTypedJson</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">customerName</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">customerEmail</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
Tha class can be any POJO class which can be serialized to JSON using <a href="https://github.com/FasterXML/jackson">Jackson library</a>. </p>
<div class="admonition note">
<p class="admonition-title">IsTypedJson</p>
<p>Event can be any POJO class. This creates some challenges with JSON serialization and de-serialization. In serialization process, we need to store the FCCN of the POJO into @class attribute of the JSON. This is done using the <code class="highlight"><span class="nd">@JsonTypeInfo</span><span class="p">(</span><span class="n">use</span> <span class="o">=</span> <span class="n">Id</span><span class="p">.</span><span class="na">CLASS</span><span class="p">)</span></code> annotation.</p>
<p>To deserialize the JSON we need to define common base class <code class="highlight"><span class="n">IsTypedJson</span></code> and register theses using Jackson mixins like <code class="highlight"><span class="n">JsonUtils</span><span class="p">.</span><span class="na">getObjectMapper</span><span class="p">().</span><span class="na">addMixIn</span><span class="p">(</span><span class="n">IsTypedJson</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">NewCustomerRegistrationEvent</span><span class="p">.</span><span class="na">class</span><span class="p">);</span></code></p>
<p>This process will be simplified in the future versions and the IsTypedJson interface will be removed</p>
</div>
<p>Next step is to create custom converter which understand the Event class and is able to create notification from it. To achieve this goal we need to provide implementation of <code class="highlight"><span class="n">InputEvent2MessageConverterExtension</span></code> interface and register it as <code class="highlight"><span class="nd">@Component</span></code> </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EventToMessageConverter</span> <span class="kd">implements</span> <span class="n">InputEvent2MessageConverterExtension</span> <span class="p">{</span>

<span class="p">...</span>

<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>The interface define two methods. The method <code class="highlight"><span class="n">canHandle</span></code> is used, if our application has more implementations of <code class="highlight"><span class="n">InputEvent2MessageConverterExtension</span></code> and we want to decide which one to use for this specific event. If the converted wants to handle the event, it returns <code class="highlight"><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">()</span></code> like so</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">PayloadValidationException</span><span class="o">&gt;</span> <span class="nf">canHandle</span><span class="p">(</span><span class="n">GenericEvent</span> <span class="n">payload</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="na">getPayloadAsPojo</span><span class="p">()</span> <span class="k">instanceof</span> <span class="n">NewCustomerRegistrationEvent</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span> <span class="n">PayloadValidationException</span><span class="p">(</span><span class="s">&quot;EventToMessageConverter only handles payload of type NewCustomerRegistrationEvent &quot;</span><span class="p">));</span>
    <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Last thing is to implement the conversion itself. </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">convertEvent</span><span class="p">(</span><span class="n">GenericEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NewCustomerRegistrationEvent</span> <span class="n">regEvent</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="na">getPayloadAsPojo</span><span class="p">();</span>

        <span class="n">EmailContent</span> <span class="n">body</span> <span class="o">=</span> <span class="n">EmailContent</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
                <span class="p">.</span><span class="na">subject</span><span class="p">(</span><span class="s">&quot;Welcome on board &quot;</span> <span class="o">+</span>  <span class="n">regEvent</span><span class="p">.</span><span class="na">getCustomerName</span><span class="p">())</span>
                <span class="p">.</span><span class="na">text</span><span class="p">(</span><span class="s">&quot;We love to have you in the comunity.&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">build</span><span class="p">();</span>       

        <span class="n">EmailEndpoint</span> <span class="n">emailEndpoint</span> <span class="o">=</span> <span class="n">EmailEndpoint</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">email</span><span class="p">(</span><span class="n">regEvent</span><span class="p">.</span><span class="na">getCustomerEmail</span><span class="p">()).</span><span class="na">build</span><span class="p">();</span>

        <span class="n">EmailMessage</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EmailMessage</span><span class="p">();</span>
        <span class="n">msg</span><span class="p">.</span><span class="na">addReceivingEndpoints</span><span class="p">(</span><span class="n">emailEndpoint</span><span class="p">);</span>
        <span class="n">msg</span><span class="p">.</span><span class="na">setBody</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Now we can test the flow using the notiflow <a href="">REST-API events endpoint</a> which is accepting application events. The test for the specific example could look like this</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    <span class="nd">@Autowired</span> <span class="kd">protected</span> <span class="n">MockMvc</span> <span class="n">mockMvc</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">eventToMessage</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">NewCustomerRegistrationEvent</span> <span class="n">event</span> <span class="o">=</span> <span class="n">NewCustomerRegistrationEvent</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
                <span class="p">.</span><span class="na">customerName</span><span class="p">(</span><span class="s">&quot;John Doe&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">customerEmail</span><span class="p">(</span><span class="s">&quot;john_doe@company.com&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">build</span><span class="p">();</span>

        <span class="n">ResultActions</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">mockMvc</span>
                <span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">MockMvcRequestBuilders</span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="s">&quot;/events&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">content</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">writeObjectToJSONString</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
                <span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON_UTF8</span><span class="p">)</span>             
                <span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">APPLICATION_JSON_UTF8</span><span class="p">));</span>

        <span class="n">resp</span>
            <span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="na">is2xxSuccessful</span><span class="p">())</span>
            <span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">jsonPath</span><span class="p">(</span><span class="s">&quot;$.ncEventId&quot;</span><span class="p">).</span><span class="na">value</span><span class="p">(</span><span class="n">CoreMatchers</span><span class="p">.</span><span class="na">notNullValue</span><span class="p">()));</span>

        <span class="kt">boolean</span> <span class="n">recieved</span> <span class="o">=</span> <span class="n">greenMail</span><span class="p">.</span><span class="na">waitForIncomingEmail</span><span class="p">(</span><span class="mi">5000L</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

        <span class="n">assertEquals</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">recieved</span><span class="p">);</span>
        <span class="n">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">greenMail</span><span class="p">.</span><span class="na">getReceivedMessages</span><span class="p">().</span><span class="na">length</span><span class="p">);</span>

        <span class="n">MimeMessage</span> <span class="n">receivedMessage</span> <span class="o">=</span> <span class="n">greenMail</span><span class="p">.</span><span class="na">getReceivedMessages</span><span class="p">()</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
        <span class="n">MimeMessageParser</span> <span class="n">parsedEmail</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeMessageParser</span><span class="p">(</span><span class="n">receivedMessage</span><span class="p">).</span><span class="na">parse</span><span class="p">();</span>

        <span class="n">assertEquals</span><span class="p">(</span><span class="s">&quot;We love to have you in the comunity.&quot;</span><span class="p">,</span><span class="n">parsedEmail</span><span class="p">.</span><span class="na">getPlainContent</span><span class="p">());</span>
        <span class="n">assertEquals</span><span class="p">(</span><span class="s">&quot;Welcome on board John Doe&quot;</span><span class="p">,</span><span class="n">parsedEmail</span><span class="p">.</span><span class="na">getSubject</span><span class="p">());</span>
        <span class="n">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">receivedMessage</span><span class="p">.</span><span class="na">getAllRecipients</span><span class="p">().</span><span class="na">length</span><span class="p">);</span>
        <span class="n">assertEquals</span><span class="p">(</span><span class="s">&quot;john_doe@company.com&quot;</span><span class="p">,</span> <span class="n">receivedMessage</span><span class="p">.</span><span class="na">getAllRecipients</span><span class="p">()</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>     
    <span class="p">}</span>

    <span class="nd">@RegisterExtension</span>
    <span class="kd">static</span> <span class="n">GreenMailExtension</span> <span class="n">greenMail</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GreenMailExtension</span><span class="p">(</span><span class="n">ServerSetupTest</span><span class="p">.</span><span class="na">SMTP</span><span class="p">)</span>
        <span class="p">.</span><span class="na">withConfiguration</span><span class="p">(</span><span class="n">GreenMailConfiguration</span><span class="p">.</span><span class="na">aConfig</span><span class="p">().</span><span class="na">withUser</span><span class="p">(</span><span class="s">&quot;john_doe&quot;</span><span class="p">,</span> <span class="s">&quot;pwd&quot;</span><span class="p">))</span>
        <span class="p">.</span><span class="na">withPerMethodLifecycle</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h2 id="templated-email">Templated Email</h2>
<h2 id="using-test-mode">Using Test mode</h2>
<h2 id="postgresql-data-source-configuration">PostgreSQL data source configuration <span id="ds-config"/></h2>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../getting-started/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Installation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Installation
            </div>
          </div>
        </a>
      
      
        
        <a href="../flows/" class="md-footer__link md-footer__link--next" aria-label="Next: Flows" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Flows
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 - 2021 Objectify, s.r.o.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.cefbb252.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.a5f8ea78.min.js"></script>
      
    
  </body>
</html>